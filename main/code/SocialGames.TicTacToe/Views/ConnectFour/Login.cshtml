@{
    ViewBag.Title = "ConnectFour Login";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

        <script type="text/javascript" src="@Url.Content("~/Scripts/flXHR-1.0.6/flXHR.js")"></script> 
	    <script type="text/javascript" src="@Url.Content("~/Scripts/flXHR-1.0.6/jquery.flXHRproxy.js")"></script> 
        <script type="text/javascript">
        </script>

<h2>ConnectFour Login</h2>

<p>
    To test the game, open another browser window using InPrivate mode (Ctrl+Shift+P in Internet Explorer), login with an alternate account and join the battle queue from both windows.
</p>

<div class="status">
</div>

<table id="loginsTable">
</table> 

<script type="text/javascript">
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
    }

    jQuery(document).ready(function () {
        var apiURL = "@this.ViewBag.ApiUrl";

        $.flXHRproxy.registerOptions(apiURL, { xmlResponseText: false, loadPolicyURL: apiURL + "crossdomain.xml" });

        $(".status").text("Loading...");

        var returnUrl = getQueryVariable("ReturnUrl");

        if (returnUrl == null || returnUrl == undefined)
            returnUrl = "";

        // Get login info
        $.ajax({
            type: "GET",
            url: apiURL + "auth/loginselector?returnUrl=" + returnUrl,
            dataType: "json",
            success: function (result) {
                createLoginButtons(result);
            },
            error: function (req, status, error) {
                alert(error);
            }
        });
    });

    // Create the login button for each identity provider
    function createLoginButtons(loginInfoList) {
        var loginsTable = $('#loginsTable');
        loginsTable.empty();

        $(".status").text("");

        $.each(loginInfoList, function (i, loginInfo) {
            var loginButton = $('<input type="button">');

            loginButton.attr("value", loginInfo.Name);
            loginButton.click(function () { window.location.href = loginInfo.LoginUrl; });

            var loginsTableTd = $('<td>');
            loginsTableTd.append(loginButton);

            var loginsTableTr = $('<tr>');
            loginsTableTr.append(loginsTableTd);

            loginsTable.append(loginsTableTr);
        });
    }
</script>